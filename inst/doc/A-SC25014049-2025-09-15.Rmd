---
title: "Homework-2025.09.15"
author: "By SC25014049"
date: "2025/09/15"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Introduction to R-package - Homework-2025.09.15}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r star, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Question

Use the R package knitr to produce at least 3 examples. For each example, texts should mix with figures and/or tables.Better to have mathematical formulas

## Answer

### Example 1:置信区间为95%的均值估计

#### 1.1 生成符合正态分布的数据
利用随机在正态分布数据中抽样生成用于分析的数据集，设置抽样数量为100，数据前几行如下：

```{r , echo=FALSE}
set.seed(123)

data1 <- rnorm(n = 100, mean = 50, sd = 10) #均值为50，标准差为10
data2 <- data.frame(data1)
#mode(data2)
knitr::kable(head(data2))
```


#### 1.2 公式与数据计算

利用抽样的均值来估计总体的均值，令置信区间为95%，即此区间有95%的可能性包括总体均值。
$$
置信区间的范围为:(\overline{x}-Z_{\alpha/2}\frac{\sigma}{\sqrt{n}},\overline{x}+Z_{\alpha/2}\frac{\sigma}{\sqrt{n}}) 
$$

```{r , echo=FALSE}

x_mean <- mean(data1)


x_low <- x_mean-1.96*10/10
x_high <- x_mean+1.96*10/10

```

抽样数据的均值为:`r x_mean`, 查表得:$Z_{\alpha/2}=1.96$, 则求得此抽样数据的置信区间为：(`r x_low`, `r x_high`)


#### 1.3 结果分析与数据可视化

```{r , echo=FALSE}
# 绘制直方图并绘制理论正太分布曲线，评估置信区间。
hist(data1, breaks = 30, col = "lightblue", main = "正态分布数据与95%置信区间", 
     xlab = "值", 
     ylab = "频率",
     prob = TRUE,  
     ylim = c(0, 0.07))

curve(dnorm(x, mean = 50, sd = 10), 
      col = "red", lwd = 2, lty = 2, add = TRUE)

# 添加置信区间线，并填充颜色
abline(v = x_low, col = "orange", lwd = 2, lty = 2)
abline(v = x_high, col = "orange", lwd = 2, lty = 2)

x_fill <- seq(x_low, x_high, length.out = 100)
y_fill <- dnorm(x_fill, mean = x_mean, sd = sd(data1))
polygon(c(x_fill, rev(x_fill)), c(y_fill, rep(0, length(y_fill))), 
        col = rgb(1, 0.65, 0, 0.3), border = NA)

legend("topright", 
       legend = c("总体分布", "95%置信区间"),
       col = c( "red", "orange"),
       lty = c(1, 1),
       lwd = c(2, 2),
       cex = 0.8)
```

由图可得：理论正态分布曲线的均值基本落在95%置信区间。

### Example 2: 多项式拟合分析

#### 2.1 加载内置数据集car

数据集内包含汽车的速度（speed）和刹车距离（dist），数据前十行如下：
```{r , echo=FALSE}
library(car)
data(cars)
data_e2 <- cars
knitr::kable(data_e2[1:10,])

```

#### 2.2 进行2次和3次多项式拟合
2次及3次多项式拟合的公式如下：
$$
y = a_0 + a_1x +a_2x^2
\\y = a_0 + a_1x +a_2x^2 + a_3x^3
$$

```{r, echo=FALSE}
poly_model <- lm(dist ~ poly(speed, 2), data = data_e2)
poly_mode2 <- lm(dist ~ poly(speed, 3), data = data_e2)
co1 <- coef(poly_model)
co2 <- coef(poly_mode2)

```
利用lm()函数进行拟合后的公式分别为：
$y = `r co1[1]`+`r co1[2]`x +`r co1[3]`x^2$
$y = `r co2[1]`+`r co2[2]`x +`r co2[3]`x^2$

#### 2.3 拟合图像可视化

```{r,echo=FALSE}
plot(data_e2$speed, data_e2$dist, 
     main = "汽车速度与刹车距离关系",
     xlab = "速度", ylab = "刹车距离")

speed_seq <- seq(min(data_e2$speed), max(data_e2$speed), length.out = 100)
predict1 <- predict(poly_model, data.frame(speed = speed_seq))
predict2 <- predict(poly_mode2, data.frame(speed = speed_seq))
lines(speed_seq, predict1, col = "red", lwd = 2)
lines(speed_seq, predict2, col = "blue", lwd = 2)
legend("topleft", legend = c("二次多项式拟合","三次多项式拟合"), col = c("red","blue"), lwd = c(2,2))
```

### Example 3: 多元线性回归

#### 3.1 建立数据集
由于多元线性回归考虑多个输入变量与输出变量之间的关系，因此与前述多项式拟合相比需要构建新的数据集。设置三个自变量$\beta1,\beta2,\beta3$,并给予不同权重，为了分析有一点误差，设置误差项为从一个均值为0的正太分布中随机抽样。则数据集前十行如下：

```{r, echo=FALSE}

set.seed(123)
n_sam <- 200
set.seed(123)
n <- 200
x1 <- rnorm(n, mean = 10, sd = 2)
x2 <- rnorm(n, mean = 5, sd = 1.5)
x3 <- rnorm(n, mean = 8, sd = 3)

beta0 <- 2.5  
beta1 <- 1.8  
beta2 <- -0.5 
beta3 <- 1

error <- rnorm(n, mean = 0, sd = 1.5)

y <- beta0 + beta1*x1 + beta2*x2 + beta3*x3 + error

data_e3 <- data.frame(y, x1, x2, x3)
knitr::kable(data_e3[1:10,])

```
#### 3.2公式与模型拟合
多元线性回归拟合公式为：
$$
y = a_0+a_1x+a_2x_2+a_3x_3
$$
数据集中系数分别为(2.5, 1.8, -0.5, 1)。
```{r,echo=FALSE}

duoyuan_model <- lm(y ~ x1 + x2 + x3, data = data_e3)
co3 = coef(duoyuan_model)
```
拟合后的公式为：
$y = `r co3[1]`+`r co3[2]`x+`r co3[3]`x_2+`r co3[4]`x_3$

#### 3.3 结果分析
由于变量多，所以绘制残差图比较直观。这里将拟合后的残差图与设置的进行对比
```{r,echo=FALSE}


residuals <- resid(duoyuan_model)
hist(residuals, breaks = 20, 
     xlab = "残差", ylab = "频率",
     main = "残差分布直方图", col = "lightblue", border = "black")

curve(dnorm(x, mean = 0, sd = 1.5)* 100, 
      from = -4.5, to = 4.5,  # 覆盖±3个标准差的范围
      main = "正态分布曲线",
      col = "blue", lwd = 2, add=TRUE)

```
