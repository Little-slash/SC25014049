---
title: "Introduction to R-package"
author: "Fenghao Lu"
date: "2025-12-08"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Introduction to R-package}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r,echo=FALSE}

knitr::include_graphics("./dsc_analyze.png")
```

## IUntroduction
此R包可专门用来做热分析数据的，即DSC和TGA。使用起来其实不难，只要把输入数据准备好，然后调用对用的函数即可。

## 1. dsc_analyze function

首先，输入已经测试的DSC的实验数据，有两列组成，一个是温度，一个是热流。温度单位为摄氏度，热流为毫瓦。必须确保这两个向量的长度是一样的，否则函数会报错。可以用read.csv或者read.table从文件进行读取。

DSC分析为dsc_analyze函数。它有主要的三个参数：temperature、heat_flow和baseline_method。前两个就是准备好的数据向量，第三是选“linear”或者“convex”，就是用来校正基线的方法，如果不指定，它就默认用“linear”线性基线校准。函数跑完以后，会返回一个结果列表，“dsc_result”的特殊对象。其中主要分为两部分，有原始数据、基线数据、校正后的数据，还有检测到的峰的信息，像峰的位置、焓变值、起始温度，以及还有玻璃化转变温度。可以直接用print函数打印它，就能在控制台看到一个比较简单的摘要，包含材料分析常用的数据。

举个实际例子。先模拟一点数据。比如我们想模拟一个从0度到300度的升温过程，有200个数据点。热流信号：它在150度和250度附近有两个转变峰，使用dnorm的函数来模拟，再加上背景信号。使用代码如下：
```{r,echo=TRUE,eval=FALSE}

temp <- seq(0, 300, length.out = 200) # 从0到300度，200个点
heat_flow<- 0.5 - 0.3 * dnorm(temp, mean = 150, sd = 15) + 0.8 * dnorm(temp, mean = 250, sd = 12)

rel <- dsc_analyze(temperature = temp, heat_flow = heat_flow, baseline_method = "linear")


print(rel) 

```

## 2. tga_analyze function

```{r,echo=FALSE}

knitr::include_graphics("./tga_analyze.png")
```
与DSC数据处理类似，输入已经测试的TGA的实验数据，通常有两列组成，一个是温度，一个是质量百分比。温度单位为摄氏度，质量百分比为相对于初始质量的百分比。同样确保这两个向量的长度是一样的，否则函数会报错。可以用read.csv或者read.table从文件进行读取。
TGA分析为tga_analyze函数。它有主要的三个参数：temperature、mass和n_components。前两个就是准备好的数据向量，第三个是设置期望的分解组分数量（1-4），如果不指定，它就默认用2个组分进行分解分析。函数跑完以后，会返回一个结果列表，"tga_result"的特殊对象。其中主要包含原始数据、微分热重（DTG）信号、分解组分分析结果（如各组分失重百分比、峰值温度），以及热稳定性参数（如残炭率、T5/T95温度）。可以直接用print函数打印它，就能在控制台看到一个比较详细的摘要，包含热重分析常用的数据。

举个实际例子。先模拟一点数据。比如我们想模拟一个从30度到800度的升温过程，有200个数据点。质量百分比信号：在约100度、300度和500度附近有三个失重步骤，使用数学函数来模拟。使用代码如下：

```{r,echo=TRUE}
library(SC25014049)
simulate_tga <- function(temp, stages) {
  # stages是一个列表，每个元素包含: loss (总损失%), T0 (中心温度), k (速率), T_start (起始温度)
  total_loss <- 0
  for (s in stages) {
    effective_temp <- pmax(temp - s$T_start, 0)
    stage_loss <- s$loss / (1 + exp(-s$k * (temp - s$T0)))
    total_loss <- total_loss + stage_loss
  }
  mass_remaining <- 100 - total_loss
  return(mass_remaining)
}

stages <- list(
  list(loss = 5, T0 = 100, k = 0.1, T_start = 50),   # 阶段1：低温脱水
  list(loss = 40, T0 = 350, k = 0.07, T_start = 200), # 阶段2：主分解[citation:2]
  list(loss = 30, T0 = 550, k = 0.05, T_start = 400)  # 阶段3：高温碳化[citation:2]
)

temp <- seq(30, 800, length.out = 200)
mass <- simulate_tga(temp, stages)

plot(temp, mass, type = "l", col = "blue", lwd = 2,
     xlab = "Temperature (°C)", ylab = "Mass Remaining (%)",
     main = "Simulated TGA Curve (Three-Stage Decomposition)",
     ylim = c(0, 100))
grid()

rel <- tga_analyze(temperature = temp, mass = mass, n_components = 3)
print(rel)
```
